!
{% set vlan_group = device.site.vlan_groups.get(name=device.name) if device.site and device.site.vlan_groups else None %}
{% set vlans = vlan_group.vlans.all() %}
{% set mgmt_vlan = vlan_group.vlans.get(name='mgmt') if vlan_group and vlan_group.vlans else None %}
{% set mgmt_vid = mgmt_vlan.vid if mgmt_vlan else None %}
!
no service pad
no platform punt-keepalive disable-kernel-core
no ip domain lookup
no ip finger 
no ip bootp server
ip dhcp bootp ignore 
no service dhcp
no service config
no ip http server
no ip http secure-server
no service tcp-small-servers
no ip source-route
no service udp-small-servers
no service call-home
service unsupported-transceiver
!

service tcp-keepalives-in
service tcp-keepalives-out
!
service timestamps debug datetime msec show-timezone
service timestamps log datetime msec show-timezone
!
service password-encryption
!
lldp run
!
hostname  {{ device.name }}
!
logging discriminator HIDE_LOG severity drops 4 facility drops PLATFORM mnemonics drops ELEMENT_WARNING
logging count
logging buffered discriminator HIDE_LOG 1000000
logging console discriminator HIDE_LOG critical
logging monitor discriminator HIDE_LOG
!
username sunlocal privilege 15 secret 9 $9$ubbUiHAeoXkBc.$YqtDN9PD07ue8lCdZW8XpOvygGb7r3lOYEAQi7Gyka.
enable secret 9 $9$KUQ3lTSgrdAc6U$V9.vfvjelox14/zdQxmToY6LAFeVmQ3iq57eGsXeUF6
!
aaa new-model
!
tacacs server WesternTacacsServers
   address ipv4 10.146.119.221
   key 7 044B0E121D71585C581809
   timeout 30
tacacs server EasternTacacsServers
   address ipv4 10.22.128.221
   key 7 044B0E121D71585C581809
   timeout 30
aaa group server tacacs+ SuncorTacacsServers
   server name WesternTacacsServers
   server name EasternTacacsServers   
   ip tacacs source-interface Vlan{{ mgmt_vid}}
!
ip domain name network.lan

ip dhcp snooping
no ip dhcp snooping information option
ip dhcp snooping vlan 1-4094
!
mac address-table notification change
mac address-table notification mac-move
!
vtp mode off
!
udld aggressive
!
crypto key generate rsa modulus 4096
!
!
spanning-tree mode mst
spanning-tree mst configuration
name Suncor_MST
revision 1
instance 0 vlan 1-4094
spanning-tree mst 0 priority 32768
spanning-tree portfast bpduguard default
no spanning-tree etherchannel guard misconfig
spanning-tree portfast default
spanning-tree extend system-id
!
!
errdisable recovery cause udld
errdisable recovery cause bpduguard
errdisable recovery cause security-violation
errdisable recovery cause channel-misconfig
errdisable recovery cause pagp-flap
errdisable recovery cause dtp-flap
errdisable recovery cause link-flap
errdisable recovery cause sfp-config-mismatch
errdisable recovery cause gbic-invalid
errdisable recovery cause l2ptguard
errdisable recovery cause psecure-violation
errdisable recovery cause port-mode-failure
errdisable recovery cause dhcp-rate-limit
errdisable recovery cause pppoe-ia-rate-limit
errdisable recovery cause mac-limit
errdisable recovery cause storm-control
errdisable recovery cause inline-power
errdisable recovery cause arp-inspection
errdisable recovery cause link-monitor-failure
errdisable recovery cause oam-remote-failure
errdisable recovery cause loopback
errdisable recovery cause psp
!
device-tracking policy trusted_policy
device-role switch
trusted-port
!
!
password encryption aes
!
redundancy
mode sso
!
{% for vlan_id in vlans %}
vlan {{ vlan_id.vid }}
   name {{ vlan_id.name }}
!
{% endfor %}
!
interface vlan{{ mgmt_vid}}
ip address {{ mgmt_int_ip_add }} {{ mgmt_int_mask }}
no ip redirects 
!
ip default-gateway {{ gateway }}
!
no qos rewrite ip dscp
qos queue-softmax-multiplier 1200 
!
logging history size 50
logging trap notifications
logging facility local5
logging source-interface Vlan{{ mgmt_vid}}
logging host 10.157.1.196
logging host 10.159.1.196
logging host 10.145.88.29
logging host 10.146.88.29
logging host 10.22.120.57
logging host 10.146.78.4
!
ip access-list standard acl-snmp-read-only
permit 10.22.120.57
permit 10.146.88.29
permit 10.145.88.29
permit 10.157.1.192 0.0.0.31
permit 10.159.1.192 0.0.0.31
permit 10.8.31.0 0.0.0.127
permit 10.16.31.0 0.0.0.127
permit 10.64.31.0 0.0.0.127
permit 10.22.66.128 0.0.0.127
deny   any log
!
